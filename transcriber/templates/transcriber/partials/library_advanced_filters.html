<!-- Advanced Library Filters Panel -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">

    <!-- Key Signature Filter -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Key Signature</label>
        <select x-model="filters.key" @change="submitSearch()"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-musical-gold focus:border-transparent bg-white text-gray-900">
            <option value="">All Keys</option>
            <!-- Major Keys -->
            <optgroup label="Major Keys">
                <option value="C">C Major</option>
                <option value="C#">C# Major</option>
                <option value="D">D Major</option>
                <option value="D#">D# Major</option>
                <option value="E">E Major</option>
                <option value="F">F Major</option>
                <option value="F#">F# Major</option>
                <option value="G">G Major</option>
                <option value="G#">G# Major</option>
                <option value="A">A Major</option>
                <option value="A#">A# Major</option>
                <option value="B">B Major</option>
            </optgroup>
            <!-- Minor Keys -->
            <optgroup label="Minor Keys">
                <option value="Cm">C Minor</option>
                <option value="C#m">C# Minor</option>
                <option value="Dm">D Minor</option>
                <option value="D#m">D# Minor</option>
                <option value="Em">E Minor</option>
                <option value="Fm">F Minor</option>
                <option value="F#m">F# Minor</option>
                <option value="Gm">G Minor</option>
                <option value="G#m">G# Minor</option>
                <option value="Am">A Minor</option>
                <option value="A#m">A# Minor</option>
                <option value="Bm">B Minor</option>
            </optgroup>
        </select>
    </div>

    <!-- Tempo Range Filter -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Tempo Range (BPM)</label>
        <div class="flex space-x-2">
            <input type="number" x-model="filters.tempo.min" @input.debounce.500ms="submitSearch()" placeholder="Min"
                min="40" max="300"
                class="w-1/2 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-musical-gold focus:border-transparent bg-white text-gray-900">
            <input type="number" x-model="filters.tempo.max" @input.debounce.500ms="submitSearch()" placeholder="Max"
                min="40" max="300"
                class="w-1/2 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-musical-gold focus:border-transparent bg-white text-gray-900">
        </div>
        <div class="mt-1 flex justify-between text-xs text-gray-500">
            <span>Slow (60-90)</span>
            <span>Fast (140-180)</span>
        </div>
    </div>

    <!-- Difficulty Level Filter -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Difficulty Level</label>
        <select x-model="filters.difficulty" @change="submitSearch()"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-musical-gold focus:border-transparent bg-white text-gray-900">
            <option value="">All Levels</option>
            <option value="beginner">ğŸŸ¢ Beginner</option>
            <option value="intermediate">ğŸŸ¡ Intermediate</option>
            <option value="advanced">ğŸ”´ Advanced</option>
            <option value="expert">âš« Expert</option>
        </select>
    </div>

    <!-- Instruments Filter -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Instruments</label>
        <div class="relative" x-data="{ open: false }">
            <button @click="open = !open" type="button"
                class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-musical-gold focus:border-transparent bg-white text-gray-900 text-left flex items-center justify-between">
                <span
                    x-text="filters.instruments.length > 0 ? filters.instruments.length + ' selected' : 'Any instrument'"></span>
                <svg class="w-4 h-4 transform transition-transform" :class="open ? 'rotate-180' : ''" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </button>

            <!-- Dropdown -->
            <div x-show="open" @click.away="open = false" x-transition:enter="transition ease-out duration-100"
                x-transition:enter-start="transform opacity-0 scale-95"
                x-transition:enter-end="transform opacity-100 scale-100"
                x-transition:leave="transition ease-in duration-75"
                x-transition:leave-start="transform opacity-100 scale-100"
                x-transition:leave-end="transform opacity-0 scale-95"
                class="absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-lg border border-gray-200 overflow-y-auto">

                <div class="py-2">
                    <label class="flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" value="guitar" @change="toggleInstrument('guitar')"
                            :checked="filters.instruments.includes('guitar')"
                            class="rounded border-gray-300 text-musical-gold focus:ring-musical-gold">
                        <span class="ml-2 text-sm text-gray-700">ğŸ¸ Guitar</span>
                    </label>
                    <label class="flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" value="bass" @change="toggleInstrument('bass')"
                            :checked="filters.instruments.includes('bass')"
                            class="rounded border-gray-300 text-musical-gold focus:ring-musical-gold">
                        <span class="ml-2 text-sm text-gray-700">ğŸ¸ Bass</span>
                    </label>
                    <label class="flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" value="drums" @change="toggleInstrument('drums')"
                            :checked="filters.instruments.includes('drums')"
                            class="rounded border-gray-300 text-musical-gold focus:ring-musical-gold">
                        <span class="ml-2 text-sm text-gray-700">ğŸ¥ Drums</span>
                    </label>
                    <label class="flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" value="piano" @change="toggleInstrument('piano')"
                            :checked="filters.instruments.includes('piano')"
                            class="rounded border-gray-300 text-musical-gold focus:ring-musical-gold">
                        <span class="ml-2 text-sm text-gray-700">ğŸ¹ Piano</span>
                    </label>
                    <label class="flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" value="vocals" @change="toggleInstrument('vocals')"
                            :checked="filters.instruments.includes('vocals')"
                            class="rounded border-gray-300 text-musical-gold focus:ring-musical-gold">
                        <span class="ml-2 text-sm text-gray-700">ğŸ¤ Vocals</span>
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sort Options -->
<div class="mt-4 pt-4 border-t border-gray-200">
    <div class="flex items-center justify-between">
        <label class="text-sm font-medium text-gray-700">Sort by:</label>
        <select x-model="sortBy" @change="submitSearch()"
            class="px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-musical-gold focus:border-transparent bg-white text-gray-900">
            <option value="-created_at">ğŸ“… Newest First</option>
            <option value="created_at">ğŸ“… Oldest First</option>
            <option value="filename">ğŸ”¤ Name (A-Z)</option>
            <option value="-filename">ğŸ”¤ Name (Z-A)</option>
            <option value="-estimated_tempo">âš¡ Fastest Tempo</option>
            <option value="estimated_tempo">ğŸŒ Slowest Tempo</option>
            <option value="-duration">â±ï¸ Longest Duration</option>
            <option value="duration">â±ï¸ Shortest Duration</option>
            <option value="-playability_score">ğŸ¯ Most Playable</option>
            <option value="playability_score">ğŸ’ª Most Challenging</option>
        </select>
    </div>
</div>

<!-- Note: toggleInstrument function is handled in the parent search component -->