<!-- Variant preview with AlphaTab -->
<div class="bg-white rounded-lg shadow-md p-4 variant-preview">
    <div class="mb-4 flex justify-between items-center">
        <h4 class="text-lg font-semibold">
            Preview: {{ variant.get_variant_name_display }} Variant
        </h4>
        <div class="flex gap-2">
            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-sm rounded">
                Playability: {{ variant.playability_score|floatformat:0 }}%
            </span>
            <button 
                hx-post="{% url 'transcriber:select_variant' transcription.id variant.id %}"
                hx-target="#variants-container"
                hx-swap="outerHTML"
                class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-sm"
            >
                Use This Variant
            </button>
        </div>
    </div>
    
    <!-- AlphaTab Container -->
    <div id="alphaTab-variant-{{ variant.id }}" class="at-container">
        <div class="at-main"></div>
    </div>
</div>

<script>
    // Initialize AlphaTab for the variant preview
    (function() {
        const musicXML = `{{ musicxml|safe }}`;
        
        // Create AlphaTab instance for this specific variant
        const settings = {
            core: {
                engine: "html5",
                logLevel: "warning"
            },
            display: {
                layoutMode: "page",
                staveProfile: "tab",
                resources: {
                    // Use default resources
                }
            },
            notation: {
                elements: {
                    scoreTitle: false,
                    scoreWordsAndMusic: false,
                    effectTempo: true,
                    effectDynamics: true,
                    guitarTuning: true
                }
            },
            player: {
                enablePlayer: true,
                enableCursor: true,
                enableUserInteraction: true,
                soundFont: "https://cdn.jsdelivr.net/npm/@coderline/alphatab@latest/dist/soundfont/sonivox.sf2"
            }
        };
        
        const api = new alphaTab.AlphaTabApi(
            document.querySelector('#alphaTab-variant-{{ variant.id }} .at-main'),
            settings
        );
        
        // Load the MusicXML
        api.load(musicXML, 0);
        
        // Store reference for cleanup
        window.variantAlphaTabApi = api;
    })();
</script>