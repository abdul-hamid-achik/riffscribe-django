{% load static %}

<div class="tab-preview-container">
    {% if transcription.status == 'completed' and transcription.guitar_notes %}
    <div class="relative">
        <!-- AlphaTab preview container -->
        <div id="alphatab-mini" 
             class="bg-white rounded-lg border border-gray-200 overflow-hidden"
             style="min-height: 200px;">
            <div class="p-4">
                <!-- Tab notation preview (first few measures) -->
                <pre class="text-xs font-mono text-gray-700 overflow-x-auto">
e|--0---2---3---2---0-------0---2---3---5---3---2---0-------
B|----3---3---3---3---3---3---3---3---3---3---3---3---3-----
G|----------------------------------------------------------
D|----------------------------------------------------------
A|----------------------------------------------------------
E|----------------------------------------------------------
                </pre>
            </div>
        </div>
        
        <!-- Overlay controls -->
        <div class="absolute bottom-2 right-2 flex items-center gap-2">
            <button onclick="playPreview()" 
                    class="p-2 bg-white/90 backdrop-blur rounded-full shadow-md hover:bg-white transition">
                <svg class="w-4 h-4 text-musical-gold" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/>
                </svg>
            </button>
        </div>
    </div>
    
    <script>
        // Initialize AlphaTab for mini preview
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof alphaTab !== 'undefined' && document.getElementById('alphatab-mini')) {
                const api = new alphaTab.AlphaTabApi(document.getElementById('alphatab-mini'), {
                    core: {
                        engine: 'html5',
                        logLevel: 'warning'
                    },
                    display: {
                        scale: 0.8,
                        layoutMode: 'page',
                        staveProfile: 'tab'
                    },
                    notation: {
                        elements: {
                            scoreTitle: false,
                            scoreWordsAndMusic: false,
                            effectTempo: false
                        }
                    }
                });
                
                // Load tab data
                {% if transcription.musicxml_content %}
                api.load({{ transcription.musicxml_content|safe }});
                {% endif %}
            }
        });
        
        function playPreview() {
            // Placeholder for playback functionality
            console.log('Playing preview...');
        }
    </script>
    
    {% else %}
    <!-- Loading or empty state -->
    <div class="bg-gray-50 rounded-lg p-8 text-center">
        <svg class="w-12 h-12 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
        </svg>
        <p class="text-gray-500 text-sm">Tab preview will appear here when ready</p>
    </div>
    {% endif %}
</div>